<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Racer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: manipulation;
        }

        #gameContainer {
            width: 100%;
            height: 100vh;
            position: relative;
            background: #000;
        }

        #road {
            width: 100%;
            height: 100%;
            position: absolute;
            background: 
                linear-gradient(90deg, #333 0%, #333 20%, transparent 20%, transparent 80%, #333 80%, #333 100%),
                linear-gradient(#444 1px, transparent 1px);
            background-size: 100% 100%, 100% 50px;
            animation: roadMove 2s linear infinite;
        }

        @keyframes roadMove {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 0 0, 0 50px; }
        }

        #playerCar {
            width: 60px;
            height: 100px;
            background: linear-gradient(45deg, #ff0000, #cc0000);
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px 10px 0 0;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            transition: left 0.1s ease;
        }

        .car-wheel {
            width: 15px;
            height: 25px;
            background: #333;
            position: absolute;
            bottom: -10px;
            border-radius: 3px;
        }

        .wheel-front { left: 5px; }
        .wheel-back { right: 5px; }

        .obstacle {
            width: 60px;
            height: 100px;
            position: absolute;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }

        #scoreDisplay {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
        }

        #speedDisplay {
            position: absolute;
            top: 60px;
            left: 20px;
            color: #00ff00;
            font-size: 18px;
            z-index: 100;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }

        .control-btn {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            backdrop-filter: blur(10px);
        }

        .control-btn:active {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0.95);
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 1000;
            border: 2px solid #ff0000;
            min-width: 300px;
        }

        #gameOver h2 {
            color: #ff0000;
            margin-bottom: 20px;
            font-size: 28px;
        }

        #finalScore {
            font-size: 24px;
            margin: 20px 0;
            color: #00ff00;
        }

        .game-btn {
            background: linear-gradient(45deg, #0088cc, #0055aa);
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.4);
        }

        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: white;
        }

        #startScreen h1 {
            font-size: 36px;
            margin-bottom: 20px;
            color: #ff0000;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        #startScreen p {
            font-size: 18px;
            margin-bottom: 30px;
            text-align: center;
            max-width: 80%;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px;
            max-width: 80%;
        }

        .lane-indicator {
            position: absolute;
            bottom: 160px;
            width: 60px;
            height: 5px;
            background: #00ff00;
            border-radius: 2px;
            transition: left 0.1s ease;
            z-index: 50;
        }

        @media (max-width: 768px) {
            .control-btn {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
            
            #scoreDisplay {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="road"></div>
        <div id="playerCar">
            <div class="car-wheel wheel-front"></div>
            <div class="car-wheel wheel-back"></div>
        </div>
        <div class="lane-indicator" id="laneIndicator"></div>
        
        <div id="scoreDisplay">–û—á–∫–∏: 0</div>
        <div id="speedDisplay">–°–∫–æ—Ä–æ—Å—Ç—å: 0 –∫–º/—á</div>
        
        <div id="controls">
            <div class="control-btn" id="leftBtn">‚¨ÖÔ∏è</div>
            <div class="control-btn" id="rightBtn">‚û°Ô∏è</div>
        </div>
        
        <div id="startScreen">
            <h1>üèéÔ∏è TELEGRAM RACER</h1>
            <div class="instructions">
                <p>üöó <strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong></p>
                <p>‚Ä¢ –ù–∞–∂–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ ‚Üê –∏ ‚Üí –¥–ª—è –ø–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏—è</p>
                <p>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ (–Ω–∞ –ü–ö)</p>
                <p>‚Ä¢ –û–±–≥–æ–Ω—è–π—Ç–µ –º–∞—à–∏–Ω—ã –∏ –Ω–∞–±–∏—Ä–∞–π—Ç–µ –æ—á–∫–∏!</p>
                <p>‚Ä¢ –ò–≥—Ä–∞ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º</p>
            </div>
            <button class="game-btn" id="startBtn">üöÄ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
            <p style="margin-top: 20px; font-size: 14px; color: #888;">
                –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
            </p>
        </div>
        
        <div id="gameOver">
            <h2>üí• –ê–í–ê–†–ò–Ø!</h2>
            <p>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</p>
            <div id="finalScore">–í–∞—à —Å—á–µ—Ç: 0</div>
            <button class="game-btn" id="restartBtn">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            <button class="game-btn" id="shareBtn" style="background: linear-gradient(45deg, #28a745, #1e7e34);">
                üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—á–µ—Ç–æ–º
            </button>
        </div>
    </div>

    <script>
        // Telegram WebApp API
        let tg = window.Telegram.WebApp;
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameActive = false;
        let score = 0;
        let gameSpeed = 5;
        let playerLane = 1; // 0: –ª–µ–≤–∞—è, 1: —Ü–µ–Ω—Ç—Ä, 2: –ø—Ä–∞–≤–∞—è
        let obstacles = [];
        let gameInterval;
        let obstacleInterval;
        let lanePositions = [20, 50, 80]; // –ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —à–∏—Ä–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const playerCar = document.getElementById('playerCar');
        const laneIndicator = document.getElementById('laneIndicator');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const speedDisplay = document.getElementById('speedDisplay');
        const gameOverScreen = document.getElementById('gameOver');
        const startScreen = document.getElementById('startScreen');
        const finalScore = document.getElementById('finalScore');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            if (tg) {
                tg.expand();
                tg.BackButton.show();
                tg.BackButton.onClick(exitGame);
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            setupControls();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
            startScreen.style.display = 'flex';
        }
        
        function setupControls() {
            // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('leftBtn').addEventListener('click', moveLeft);
            document.getElementById('rightBtn').addEventListener('click', moveRight);
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('restartBtn').addEventListener('click', startGame);
            document.getElementById('shareBtn').addEventListener('click', shareScore);
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            document.addEventListener('keydown', (e) => {
                if (!gameActive) return;
                
                if (e.key === 'ArrowLeft') moveLeft();
                if (e.key === 'ArrowRight') moveRight();
                if (e.key === ' ' || e.key === 'Spacebar') startGame(); // –ü—Ä–æ–±–µ–ª –¥–ª—è —Ä–µ—Å—Ç–∞—Ä—Ç–∞
            });
            
            // –°–≤–∞–π–ø—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            let touchStartX = 0;
            document.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
            });
            
            document.addEventListener('touchend', (e) => {
                if (!gameActive) return;
                
                const touchEndX = e.changedTouches[0].clientX;
                const diff = touchStartX - touchEndX;
                
                if (Math.abs(diff) > 50) { // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è —Å–≤–∞–π–ø–∞
                    if (diff > 0) {
                        moveRight();
                    } else {
                        moveLeft();
                    }
                }
            });
        }
        
        function startGame() {
            // –°–±—Ä–æ—Å –∏–≥—Ä—ã
            gameActive = true;
            score = 0;
            gameSpeed = 5;
            playerLane = 1;
            obstacles = [];
            
            // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            document.querySelectorAll('.obstacle').forEach(obs => obs.remove());
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            updateScore();
            updatePlayerPosition();
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            clearInterval(gameInterval);
            clearInterval(obstacleInterval);
            
            gameInterval = setInterval(gameLoop, 50);
            obstacleInterval = setInterval(createObstacle, 2000 - Math.min(score, 1500));
        }
        
        function gameLoop() {
            if (!gameActive) return;
            
            moveObstacles();
            checkCollisions();
            updateScore();
            increaseDifficulty();
        }
        
        function moveLeft() {
            if (playerLane > 0) {
                playerLane--;
                updatePlayerPosition();
            }
        }
        
        function moveRight() {
            if (playerLane < 2) {
                playerLane++;
                updatePlayerPosition();
            }
        }
        
        function updatePlayerPosition() {
            const position = lanePositions[playerLane];
            playerCar.style.left = `calc(${position}% - 30px)`;
            laneIndicator.style.left = `calc(${position}% - 30px)`;
        }
        
        function createObstacle() {
            if (!gameActive) return;
            
            const lane = Math.floor(Math.random() * 3);
            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';
            
            // –°–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –º–∞—à–∏–Ω—ã
            const colors = [
                'linear-gradient(45deg, #007bff, #0056b3)',
                'linear-gradient(45deg, #28a745, #1e7e34)',
                'linear-gradient(45deg, #6f42c1, #5a2d9c)',
                'linear-gradient(45deg, #fd7e14, #e55a00)',
                'linear-gradient(45deg, #e83e8c, #c21770)'
            ];
            obstacle.style.background = colors[Math.floor(Math.random() * colors.length)];
            
            obstacle.style.left = `calc(${lanePositions[lane]}% - 30px)`;
            obstacle.style.top = '-100px';
            
            document.getElementById('gameContainer').appendChild(obstacle);
            
            obstacles.push({
                element: obstacle,
                lane: lane,
                position: -100
            });
        }
        
        function moveObstacles() {
            obstacles.forEach((obstacle, index) => {
                obstacle.position += gameSpeed;
                obstacle.element.style.top = obstacle.position + 'px';
                
                // –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã—à–µ–¥—à–∏—Ö –∑–∞ —ç–∫—Ä–∞–Ω –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
                if (obstacle.position > window.innerHeight) {
                    obstacle.element.remove();
                    obstacles.splice(index, 1);
                    score += 10;
                }
            });
        }
        
        function checkCollisions() {
            const playerRect = playerCar.getBoundingClientRect();
            
            for (let obstacle of obstacles) {
                const obstacleRect = obstacle.element.getBoundingClientRect();
                
                // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
                if (obstacle.lane === playerLane &&
                    obstacleRect.bottom > playerRect.top &&
                    obstacleRect.top < playerRect.bottom) {
                    gameOver();
                    return;
                }
            }
        }
        
        function increaseDifficulty() {
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 100 –æ—á–∫–æ–≤
            if (score > 0 && score % 100 === 0) {
                gameSpeed += 0.5;
            }
            
            // –£—Å–∫–æ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            clearInterval(obstacleInterval);
            const interval = Math.max(500, 2000 - score * 0.8);
            obstacleInterval = setInterval(createObstacle, interval);
        }
        
        function updateScore() {
            scoreDisplay.textContent = `–û—á–∫–∏: ${score}`;
            speedDisplay.textContent = `–°–∫–æ—Ä–æ—Å—Ç—å: ${Math.round(gameSpeed * 20)} –∫–º/—á`;
        }
        
        function gameOver() {
            gameActive = false;
            clearInterval(gameInterval);
            clearInterval(obstacleInterval);
            
            finalScore.textContent = `–í–∞—à —Å—á–µ—Ç: ${score}`;
            gameOverScreen.style.display = 'block';
            
            // –í–∏–±—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
            if (navigator.vibrate) {
                navigator.vibrate(200);
            }
        }
        
        function shareScore() {
            if (tg && tg.sendData) {
                const gameData = {
                    action: 'game_score',
                    score: score,
                    game: 'racer'
                };
                tg.sendData(JSON.stringify(gameData));
            }
            tg.close();
        }
        
        function exitGame() {
            if (gameActive) {
                if (confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É?')) {
                    tg.close();
                }
            } else {
                tg.close();
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = initGame;
        
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
        window.addEventListener('resize', () => {
            updatePlayerPosition();
        });
    </script>
</body>
</html>